<h1 class="text-3xl font-bold text-gray-800 mb-6"><%= title %></h1>

<div class="bg-white p-8 rounded-lg shadow-md max-w-2xl mx-auto">
    <form action="<%= action %>" method="POST">
        <input type="hidden" name="_csrf" value="<%= csrfToken %>">

        <div class="mb-4">
            <label for="nama_kegiatan" class="block text-gray-700 text-sm font-bold mb-2">Activity Name</label>
            <input type="text" id="nama_kegiatan" name="nama_kegiatan" value="<%= typeof activity !== 'undefined' ? activity.nama_kegiatan : '' %>"
                   class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
        </div>

        <div class="mb-4">
            <label for="deskripsi" class="block text-gray-700 text-sm font-bold mb-2">Description</label>
            <textarea id="deskripsi" name="deskripsi" rows="4"
                      class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required><%= typeof activity !== 'undefined' ? activity.deskripsi : '' %></textarea>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
                <label for="tanggal" class="block text-gray-700 text-sm font-bold mb-2">Date</label>
                <input type="date" id="tanggal" name="tanggal" value="<%= typeof activity !== 'undefined' && activity.tanggal ? new Date(activity.tanggal).toISOString().split('T')[0] : '' %>"
                       class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
            </div>
            <div>
                <label for="waktu_mulai" class="block text-gray-700 text-sm font-bold mb-2">Start Time</label>
                <input type="time" id="waktu_mulai" name="waktu_mulai" value="<%= typeof activity !== 'undefined' ? activity.waktu_mulai : '' %>"
                       class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
            </div>
        </div>

        <div class="mb-6">
            <label for="id_lokasi" class="block text-gray-700 text-sm font-bold mb-2">Location</label>
            <select id="id_lokasi" name="id_lokasi" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                <option value="">Select a location</option>
                <% locations.forEach(location => { %>
                    <option value="<%= location.id_lokasi %>" <%= (typeof activity !== 'undefined' && activity.id_lokasi == location.id_lokasi) ? 'selected' : '' %>>
                        <%= location.nama_lokasi %>
                    </option>
                <% }) %>
            </select>
        </div>

        <div class="flex items-center justify-between">
            <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                <%= typeof activity.id_kegiatan !== 'undefined' ? 'Update Activity' : 'Create Activity' %>
            </button>
            <a href="/admin/campus" class="inline-block align-baseline font-bold text-sm text-blue-500 hover:text-blue-800">
                Cancel
            </a>
        </div>
    </form>
</div>

<style>
.selection-marker {
    position: absolute;
    width: 20px;
    height: 20px;
    background: #22c55e; /* green-500 */
    border-radius: 50%;
    border: 2px solid white;
    transform: translate(-50%, -50%);
    box-shadow: 0 2px 5px rgba(0,0,0,0.4);
    z-index: 10;
    pointer-events: none;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const mapPicker = document.getElementById('campusMapPicker');
    const coordXInput = document.getElementById('koordinat_x');
    const coordYInput = document.getElementById('koordinat_y');
    if (!mapPicker || !coordXInput || !coordYInput) return;

    let marker = null;

    mapPicker.addEventListener('click', (e) => {
        const rect = mapPicker.getBoundingClientRect();
        const x = ((e.clientX - rect.left) / rect.width) * 100;
        const y = ((e.clientY - rect.top) / rect.height) * 100;
        
        const coordX = x.toFixed(2);
        const coordY = y.toFixed(2);

        coordXInput.value = coordX;
        coordYInput.value = coordY;
        
        if (!marker) {
            marker = document.createElement('div');
            marker.className = 'selection-marker';
            mapPicker.appendChild(marker);
        }
        marker.style.left = `${coordX}%`;
        marker.style.top = `${coordY}%`;
    });
});
</script>