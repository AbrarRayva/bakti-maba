<!DOCTYPE html>
<html>
<head>
  <title>Histori Tugas</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-6 bg-gray-100">
  <div class="max-w-5xl mx-auto bg-white shadow rounded p-6">
    <h1 class="text-2xl font-bold mb-6">Penugasan</h1>

    <!-- Tab Navigation -->
    <div class="flex border-b mb-6">
      <a href="?tab=ongoing" class="px-4 py-2 font-medium <%= currentTab === 'ongoing' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-gray-500' %>">On-Going</a>
      <a href="?tab=completed" class="px-4 py-2 font-medium <%= currentTab === 'completed' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-gray-500' %>">Completed</a>
    </div>

    <% if (currentTab === 'ongoing') { %>
      <!-- Konten On-Going -->
      <div class="mb-8">
        <h2 class="text-xl font-semibold mb-4">Tugas 1</h2>
        <ul class="space-y-2">
          <% ongoingTasks.forEach(task => { %>
            <li class="flex items-center">
              <span class="w-5 h-5 border rounded mr-2 <%= task.completed ? 'bg-green-500 border-green-500' : 'border-gray-400' %>"></span>
              <span class="<%= task.completed ? 'line-through text-gray-500' : '' %>"><%= task.name %></span>
            </li>
          <% }); %>
        </ul>
      </div>

      <div>
        <h2 class="text-xl font-semibold mb-4">Tugas 2</h2>
        <ul class="space-y-2">
          <% uncompletedTasks.forEach(task => { %>
            <li class="flex items-center">
              <span class="w-5 h-5 border rounded mr-2 <%= task.completed ? 'bg-green-500 border-green-500' : 'border-gray-400' %>"></span>
              <span class="<%= task.completed ? 'line-through text-gray-500' : '' %>"><%= task.name %></span>
            </li>
          <% }); %>
        </ul>
      </div>

    <% } else { %>
      <!-- Konten Completed -->
      <div class="mb-6">
        <h2 class="text-xl font-semibold mb-4">Daftar Tugas yang Dikumpulkan</h2>
        
        <% if (completedTasks.length === 0) { %>
          <p class="text-gray-500">Tidak ada tugas yang sudah selesai</p>
        <% } else { %>
          <table class="w-full table-auto border">
            <thead class="bg-gray-100">
              <tr>
                <th class="border p-2 text-left">Peserta</th>
                <th class="border p-2 text-left">File</th>
                <th class="border p-2 text-left">Versi</th>
                <th class="border p-2 text-left">Waktu</th>
                <th class="border p-2 text-left">Aksi</th>
              </tr>
            </thead>
            <tbody>
              <% completedTasks.forEach(group => { %>
                <% group.tasks.forEach(t => { %>
                  <tr class="hover:bg-gray-50">
                    <td class="border p-2"><%= t.nama_peserta %></td>
                    <td class="border p-2"><%= t.filename %></td>
                    <td class="border p-2">
                      <span class="px-2 py-1 text-xs rounded-full <%= t.versi === 'origin' ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800' %>">
                        <%= t.versi %>
                      </span>
                    </td>
                    <td class="border p-2"><%= new Date(t.createdAt).toLocaleString() %></td>
                    <td class="border p-2">
                      <a href="/panitia/tugas/<%= t.id %>/download" class="text-blue-600 hover:underline mr-3">Download</a>
                      <% if (t.versi === 'origin') { %>
                        <button onclick="showRevisiForm('<%= t.id %>', '<%= t.nama_peserta %>')" 
                                class="text-yellow-600 hover:underline">
                          Revisi
                        </button>
                      <% } %>
                    </td>
                  </tr>
                <% }); %>
              <% }); %>
            </tbody>
          </table>
        <% } %>
      </div>

      <!-- Form Revisi (Hidden by Default) -->
      <div id="revisiForm" class="hidden mt-8 p-4 border rounded-lg bg-gray-50">
        <h3 class="text-lg font-semibold mb-3">Upload Revisi Tugas</h3>
        <form action="/mahasiswa/revisi" method="POST" enctype="multipart/form-data">
          <input type="hidden" id="tugas_id" name="tugas_id">
          <input id="revisi_nama" name="nama_peserta" 
                 class="border p-2 w-full mb-3" readonly>
          <input type="file" name="tugas" required class="mb-3">
          <button type="submit" class="bg-yellow-500 text-white px-4 py-2 rounded">Upload Revisi</button>
        </form>
      </div>
    <% } %>
  </div>

  <script>
    function showRevisiForm(tugasId, namaPeserta) {
      document.getElementById('tugas_id').value = tugasId;
      document.getElementById('revisi_nama').value = namaPeserta;
      document.getElementById('revisiForm').classList.remove('hidden');
      document.getElementById('revisiForm').scrollIntoView({ behavior: 'smooth' });
    }
  </script>
</body>
</html>